#!/bin/bash
# Display welcome modal for first-time users

# Welcome content
# gum style \
#     --foreground 14 --bold --border-foreground 11 --border rounded \
#     --width 76 --margin "0 2" --padding "1 2" \
#     "ðŸŽ‰ CONGRATULATIONS! Your AuraOS installation is Almost complete! click Yes at the bottom to Install Aura Components for full Aura experience ðŸŽ‰"
gum style \
    --border-foreground "#27F5B4" \
    --foreground 14 \
    --border double \
    --align center \
    --width 100 \
    --margin "1 2" \
    --padding "1 4" <<'EOF'
    "ðŸŽ‰ CONGRATULATIONS! Your AuraOS installation is Almost complete! Continue to Install Aura Components for full Aura experience ðŸŽ‰"

        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ
       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
       â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ
       â–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â–ˆâ–ˆ   â–ˆâ–ˆ  â–ˆâ–ˆ   â–ˆâ–ˆ

EOF

echo

# Important setup instructions
gum style \
    --foreground 11 --border-foreground 11 --border rounded \
    --width 76 --margin "0 2" --padding "1 2" \
    "IMPORTANT: Setup Instructions"

echo

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "You are currently in Aura Hyprland! The beautiful desktop" \
    "environment is ready, but you need to install the Aura components."

echo

# STEP 1
gum style \
    --foreground 10 --bold \
    "STEP 1: Install Aura components"

gum style \
    --foreground 8 --width 76 --margin "0 4" \
    "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "The welcome prompt will ask if you want to install now."

echo
gum style \
    --foreground 14 --background 236 --padding "0 2" --margin "0 4" \
    "Choose 'Yes, install now' or run: install-aura-full"

echo

gum style \
    --foreground 243 --width 76 --margin "0 2" \
    "This will:" \
    "  â€¢ Download and build AUR dependencies (quickshell-git, etc.)" \
    "  â€¢ Build aura-cli from source" \
    "  â€¢ Build aura-shell from source" \
    "  â€¢ Takes 10-30 minutes depending on your system"

echo

# STEP 2
gum style \
    --foreground 10 --bold \
    "STEP 2: Restart Hyprland session"

gum style \
    --foreground 8 --width 76 --margin "0 4" \
    "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "After install-aura-full completes:" \
    "  1. Log out (SUPER + SHIFT + Q or top menu)" \
    "  2. Log back in" \
    "  3. The full Aura shell will now be active!"

echo

gum style \
    --foreground 13 --bold --italic \
    "âœ¨ Enjoy the beautiful Aura Hyprland desktop!"

echo

# Essential keybindings
gum style \
    --foreground 10 --border-foreground 11 --border rounded \
    --width 76 --margin "0 2" --padding "1 2" \
    "Essential Keybindings"

echo

gum style \
    --foreground "#27F5B4" --width 76 --margin "0 2" \
    "  SUPER + Return        Open terminal" \
    "  SUPER + E        Open Files" \
    "  SUPER         Application launcher" \
    "  SUPER + Q             Close window" \
    "  SUPER + 1-9           Switch workspaces" \
    "  SUPER + ALT + 1-9   Move window to workspace" \
    "  SUPER + F             Toggle window fullscreen" \
    "  SUPER + ALT + F             Toggle Bordered fullscreen" \
     "  CTRL SUPER  ALT + R             Restart Shell" \
     "  SUPER + K             Show Panels" \
     "  SUPER + L             Lock Screen" \
    "  SUPER + ALT + SPACE             Toggle floating"

echo

# Useful commands
gum style \
    --foreground 11 --border-foreground 11 --border rounded \
    --width 76 --margin "0 2" --padding "1 2" \
    "Useful Commands"

echo

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "  fastfetch       Display system information" \
    "  btop            Interactive process viewer" \
    "  lazygit         Terminal UI for git" \
    "  lazydocker      Terminal UI for docker"

echo

# Advanced info
gum style \
    --foreground 11 --border-foreground 11 --border rounded \
    --width 76 --margin "0 2" --padding "1 2" \
    "For Beginners: Optional GNOME Fallback"

echo

gum style \
    --foreground 15 --width 76 --margin "0 2" \
    "If you prefer a GNOME fallback session:" \
    "" \
    "  1. Before building ISO: Uncomment GNOME packages in" \
    "     aura/install/aura-base.packages" \
    "  2. Build ISO with GNOME included" \
    "  3. Log out and select GNOME at GDM"

echo

gum style \
    --foreground 243 --italic --width 76 --margin "0 2" \
    "Note: Hyprland is the default and recommended session"

echo

# Support
gum style \
    --foreground 243 --width 76 --margin "0 2" \
    "Support & Documentation:" \
    "  Aura: https://github.com/CjLogic/Aura" \
    "  Arch Wiki: https://wiki.archlinux.org"

echo
echo

gum style \
    --foreground "#CEFDEE" --bold --align center \
    "Enjoy your beautiful new desktop environment! âœ¨"

echo
echo

# Ask if user wants to run install-aura-full now
gum style \
    --foreground 11 --bold --align center \
    "Would you like to install Aura components now?"

echo

gum style \
    --foreground 243 --italic --align center \
    "This will run 'install-aura-full' to build aura-cli and aura-shell"

echo

# Use gum confirm for yes/no choice
if gum confirm "Start installation now?" \
    --affirmative "Yes, install now" \
    --negative "No, I'll do it later" \
    --selected.background "#27F5B4" \
    --selected.foreground "#000000"; then

    echo
    gum style \
        --foreground 10 --bold --align center \
        "Starting installation..."

    echo
    sleep 1

    # Mark welcome as shown
    mkdir -p ~/.local/state/aura
    touch ~/.local/state/aura/welcome-shown

    # Run install-aura-full with --noconfirm for streamlined installation
    if command -v install-aura-full &>/dev/null; then
        clear
        install-aura-full --noconfirm
    else
        echo
        gum style \
            --foreground 9 --bold \
            "ERROR: install-aura-full command not found!"
        echo
        gum style \
            --foreground 243 \
            "Please ensure Aura is properly installed and try again."
        echo
        echo
        read -n 1 -s -p "Press any key to close..."
    fi
else
    echo
    gum style \
        --foreground 14 --align center \
        "No problem! You can install later by running:"

    echo
    gum style \
        --foreground 14 --background 236 --padding "0 2" --align center \
        "install-aura-full"

    echo
    echo

    gum style \
        --foreground 8 --italic --align center \
        "Press any key to close this window..."

    read -n 1 -s

    # Mark welcome as shown
    mkdir -p ~/.local/state/aura
    touch ~/.local/state/aura/welcome-shown
fi
